const TRANSLATIONS = {
    it: {
        play: "Gioca",
        stats: "Statistiche",
        info: "Informazioni",
        setup: "Nuova Partita",
        deck: "Seleziona Mazzo:",
        players: "Numero Giocatori (2-40)",
        dealer: "Seleziona il primo mazziere:",
        start: "Inizia Partita",
        resume: "Riprendi ultima partita",
        round: "Round",
        cards: "Carte",
        blind: "AL BUIO",
        bidding: "Fase Chiamate:",
        taking: "Fase Giocata:",
        dealerLabel: "Mazziere:",
        last: "ultimo",
        forbidden: "Vietato chiamare:",
        confirmBid: "Conferma Chiamate",
        confirmTake: "Calcola Punti -> Prossimo",
        undo: "Indietro (Annulla Fase)",
        errorSumBid: "ERRORE: Somma chiamate",
        errorSumTake: "ERRORE: Somma prese",
        gameEnd: "Partita Terminata",
        winner: "Vincitore",
        share: "ðŸ“¤ Condividi Risultati",
        newGame: "Nuova Partita",
        history: "Storico Round (Modificabile)",
        edit: "Modifica",
        reset: "Riavvia / Azzera Dati",
        statsTitle: "Statistiche Partite",
        statsSub: "Storico delle partite concluse salvato sul dispositivo.",
        back: "Torna Indietro",
        clear: "Cancella Storico",
        infoTitle: "Informazioni",
        version: "Versione 1.0.0",
        devBy: "App sviluppata per gestire facilmente i punteggi delle tue partite.",
        like: "Ti piace l'app?",
        coffee: "Offrimi un caffÃ¨ â˜•",
        close: "Chiudi",
        confirmClear: "Sei sicuro di voler cancellare tutto lo storico delle partite?",
        confirmReset: "Sei sicuro di voler cancellare la partita corrente e tornare al menu?",
        shareError: "Impossibile condividere: ",
        shareSuccess: "Condivisione riuscita!",
        copySuccess: "Risultati copiati negli appunti!",
        save: "Salva",
        cancel: "Annulla",
        scorekeeper: "Segnapunti",
        appFullTitle: "Podrida Segnapunti",
        ranking: "Classifica",
        roundGen: "Round", // generic label
        cardsGen: "Carte",  // generic label
        playerDef: "Giocatore",
        suitOri: "Ori ðŸŸ¡",
        suitSpade: "Spade âš”ï¸",
        suitCoppe: "Coppe ðŸ†",
        suitBastoni: "Bastoni ðŸªµ",
        suitCuori: "Cuori â™¥ï¸",
        suitQuadri: "Quadri â™¦ï¸",
        suitFiori: "Fiori â™£ï¸",
        suitPicche: "Picche â™ ï¸",
        table: "Tabella",
        roundDetails: "Dettagli Round",
        showDetails: "ðŸ“Š Mostra Dettagli Completi",
        backToScore: "â† Torna al Riepilogo",
        rules: "Regole del Gioco"
    },
    en: {
        play: "Play",
        stats: "Statistics",
        info: "Info",
        setup: "New Game",
        deck: "Select Deck:",
        players: "Number of Players (2-40)",
        dealer: "Select First Dealer:",
        start: "Start Game",
        resume: "Resume Last Game",
        round: "Round",
        cards: "Cards",
        blind: "BLIND",
        bidding: "Bidding Phase:",
        taking: "Playing Phase:",
        dealerLabel: "Dealer:",
        last: "last",
        forbidden: "Forbidden to bid:",
        confirmBid: "Confirm Bids",
        confirmTake: "Calc Points -> Next",
        undo: "Undo (Cancel Phase)",
        errorSumBid: "ERROR: Sum of bids",
        errorSumTake: "ERROR: Sum of tricks",
        gameEnd: "Game Over",
        winner: "Winner",
        share: "ðŸ“¤ Share Results",
        newGame: "New Game",
        history: "Round History (Editable)",
        edit: "Edit",
        reset: "Restart / Reset Data",
        statsTitle: "Game Statistics",
        statsSub: "History of finished games saved on device.",
        back: "Go Back",
        clear: "Clear History",
        infoTitle: "Information",
        version: "Version 1.0.0",
        devBy: "App developed to easily manage your game scores.",
        like: "Do you like the app?",
        coffee: "Buy me a coffee â˜•",
        close: "Close",
        confirmClear: "Are you sure you want to clear all history?",
        confirmReset: "Are you sure you want to quit the current game?",
        shareError: "Cannot share: ",
        shareSuccess: "Share successful!",
        copySuccess: "Results copied to clipboard!",
        save: "Save",
        cancel: "Cancel",
        scorekeeper: "Scorekeeper",
        appFullTitle: "Podrida Scorekeeper",
        ranking: "Ranking",
        roundGen: "Round",
        cardsGen: "Cards",
        playerDef: "Player",
        suitOri: "Coins ðŸŸ¡",
        suitSpade: "Swords âš”ï¸",
        suitCoppe: "Cups ðŸ†",
        suitBastoni: "Clubs ðŸªµ",
        suitCuori: "Hearts â™¥ï¸",
        suitQuadri: "Diamonds â™¦ï¸",
        suitFiori: "Clubs â™£ï¸",
        suitPicche: "Spades â™ ï¸",
        table: "Table",
        roundDetails: "Round Details",
        showDetails: "ðŸ“Š Show Full Details",
        backToScore: "â† Back to Summary",
        rules: "Game Rules"
    },
    es: {
        play: "Jugar",
        stats: "EstadÃ­sticas",
        info: "Info",
        setup: "Nueva Partida",
        deck: "Seleccionar Baraja:",
        players: "NÃºmero de Jugadores (2-40)",
        dealer: "Seleccionar primer repartidor:",
        start: "Empezar Partida",
        resume: "Reanudar Ãºltima partida",
        round: "Ronda",
        cards: "Cartas",
        blind: "A CIEGAS",
        bidding: "Fase de Apuestas:",
        taking: "Fase de Juego:",
        dealerLabel: "Repartidor:",
        last: "Ãºltimo",
        forbidden: "Prohibido apostar:",
        confirmBid: "Confirmar Apuestas",
        confirmTake: "Calc Puntos -> Siguiente",
        undo: "Deshacer (Cancelar Fase)",
        errorSumBid: "ERROR: Suma de apuestas",
        errorSumTake: "ERROR: Suma de bazas",
        gameEnd: "Fin de la Partida",
        winner: "Ganador",
        share: "ðŸ“¤ Compartir Resultados",
        newGame: "Nueva Partida",
        history: "Historial Rondas (Editable)",
        edit: "Editar",
        reset: "Reiniciar / Borrar Datos",
        statsTitle: "EstadÃ­sticas de Partidas",
        statsSub: "Historial de partidas guardado en el dispositivo.",
        back: "Volver",
        clear: "Borrar Historial",
        infoTitle: "InformaciÃ³n",
        version: "VersiÃ³n 1.0.0",
        devBy: "App desarrollada para gestionar fÃ¡cilmente tus puntuaciones.",
        like: "Â¿Te gusta la app?",
        coffee: "CÃ³mprame un cafÃ© â˜•",
        close: "Cerrar",
        confirmClear: "Â¿Seguro que quieres borrar todo el historial?",
        confirmReset: "Â¿Seguro que quieres salir de la partida actual?",
        shareError: "No se puede compartir: ",
        shareSuccess: "Â¡Compartido con Ã©xito!",
        copySuccess: "Â¡Resultados copiados!",
        save: "Guardar",
        cancel: "Cancelar",
        scorekeeper: "Anotador",
        appFullTitle: "Podrida Anotador",
        ranking: "ClasificaciÃ³n",
        roundGen: "Ronda",
        cardsGen: "Cartas",
        playerDef: "Jugador",
        suitOri: "Oros ðŸŸ¡",
        suitSpade: "Espadas âš”ï¸",
        suitCoppe: "Copas ðŸ†",
        suitBastoni: "Bastos ðŸªµ",
        suitCuori: "Corazones â™¥ï¸",
        suitQuadri: "Diamantes â™¦ï¸",
        suitFiori: "TrÃ©boles â™£ï¸",
        suitPicche: "Picas â™ ï¸",
        table: "Tabla",
        roundDetails: "Detalles de Rondas",
        showDetails: "ðŸ“Š Mostrar Detalles Completos",
        backToScore: "â† Volver al Resumen",
        rules: "Reglas del Juego"
    }
};

let currentLang = 'it';

function initLang() {
    const saved = localStorage.getItem('podrida_lang');
    if (saved) currentLang = saved;
    updateLangUI();
}

function toggleLanguage() {
    // Cycle: it -> en -> es -> it
    if (currentLang === 'it') currentLang = 'en';
    else if (currentLang === 'en') currentLang = 'es';
    else currentLang = 'it';
    
    localStorage.setItem('podrida_lang', currentLang);
    updateLangUI();
}

function t(key) {
    return TRANSLATIONS[currentLang][key] || key;
}

function updateLangUI() {
    // Update Flag
    const btn = document.getElementById('lang-btn');
    let flag = 'ðŸ‡®ðŸ‡¹';
    if(currentLang === 'en') flag = 'ðŸ‡¬ðŸ‡§';
    if(currentLang === 'es') flag = 'ðŸ‡ªðŸ‡¸';
    if(btn) btn.innerText = flag;
    
    // Update Static Elements with data-i18n
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (TRANSLATIONS[currentLang][key]) {
            el.innerText = TRANSLATIONS[currentLang][key];
        }
    });

    // Trigger UI updates for dynamic content if game is running
    if(window.renderInputs && document.getElementById('screen-game') && document.getElementById('screen-game').style.display === 'block') {
         window.renderInputs(); 
         if(window.updateScoreboard) window.updateScoreboard(); 
    }
    
    // Refresh Setup UI (Suits & Player Placeholders) - resets input values but safe on Home
    if(window.updateDeckUI) window.updateDeckUI();
    if(window.renderSetupInputs) window.renderSetupInputs();

    // Update Document Title
    document.title = TRANSLATIONS[currentLang]['appFullTitle'] || "Podrida";
}
