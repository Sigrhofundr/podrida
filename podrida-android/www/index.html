<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Podrida Segnapunti</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<!-- HOME SCREEN -->
<div id="screen-home">
    <div id="lang-btn" onclick="toggleLanguage()">üáÆüáπ</div>
    <img src="assets/large.png" id="home-logo" alt="Podrida Logo">
    <h1 style="margin-bottom: 5px;">Podrida</h1>
    <p style="margin-top:0; opacity:0.8; margin-bottom: 30px;" data-i18n="scorekeeper">Segnapunti</p>

    <div class="home-btn primary" onclick="goToSetup()" data-i18n="play">Gioca</div>
    <div class="home-btn" onclick="goToStats()" data-i18n="stats">Statistiche</div>
    <div class="home-btn" onclick="openInfoModal()" data-i18n="info">Informazioni</div>
    
    <div style="margin-top: 30px; font-size: 0.8rem; opacity: 0.6;">v1.0.0</div>
</div>

<header>
    <div style="display:flex; align-items:center; justify-content:center; position:relative;">
        <div style="position:absolute; left:0; font-size:1.5rem; cursor:pointer;" onclick="showHome()">üè†</div>
        <div>
            <h1 id="header-title">Podrida</h1>
            <p id="header-subtitle">Setup</p>
        </div>
    </div>
</header>

<div id="app-container">
    
    <!-- SETUP SCREEN -->
    <div id="screen-setup" class="container">
        <div class="card">
            <h2 data-i18n="setup">Nuova Partita</h2>

            <label data-i18n="deck">Seleziona Mazzo:</label>
            <div class="deck-selector">
                <label id="opt-40" class="deck-option selected" onclick="updateDeckUI()">
                    <input type="radio" name="deckSize" value="40" checked>
                    40
                </label>
                <label id="opt-52" class="deck-option" onclick="updateDeckUI()">
                    <input type="radio" name="deckSize" value="52">
                    52
                </label>
            </div>
            <div id="suit-display-setup"></div>

            <div style="margin-top: 20px;">
                <label data-i18n="players">Numero Giocatori (2-40)</label>
                <div class="player-count-control">
                    <button class="count-btn" onclick="adjustPlayerCount(-1)">-</button>
                    <span id="setup-count">5</span>
                    <button class="count-btn" onclick="adjustPlayerCount(1)">+</button>
                </div>
            </div>

            <label style="margin-top: 20px;" data-i18n="dealer">Seleziona il primo mazziere:</label>
            <div id="player-inputs">
                <!-- Generated by JS -->
            </div>
        </div>

        <button onclick="startGame()" style="font-size: 1.2rem; padding: 15px;" data-i18n="start">Inizia Partita</button>
        
        <div style="text-align:center; margin-top:20px;">
            <button id="resume-btn" class="secondary" style="display:none;" data-i18n="resume">Riprendi ultima partita</button>
        </div>
    </div>

    <!-- GAME SCREEN -->
    <div id="screen-game" class="container" style="display:none;">
        
        <div class="tabs" id="game-tabs">
            <div class="tab active" onclick="switchTab('play')" data-i18n="play">Gioca</div>
            <div class="tab" onclick="switchTab('score')" data-i18n="ranking">Classifica</div>
            <div class="tab" onclick="switchTab('table')" data-i18n="table">Tabella</div>
        </div>

        <!-- TAB PLAY -->
        <div id="tab-play">
            <div class="card">
                <div id="round-rules" class="round-info"></div>
                <div id="suit-display-game" style="margin-bottom: 10px;"></div>
                
                <div id="game-inputs">
                    <!-- Dynamic Inputs -->
                </div>
                
                <div id="validation-msg"></div>
                
                <button id="action-btn" onclick="submitPhase()">Conferma</button>
                <button class="secondary" onclick="undoPhase()" style="margin-top:10px;" data-i18n="undo">Indietro (Annulla Fase)</button>
            </div>
        </div>

        <!-- TAB SCORE -->
        <div id="tab-score" style="display:none;">
            
            <div id="winner-section" style="display:none;">
                <!-- Winner content inserted by JS -->
            </div>

            <div class="card">
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Nome</th>
                            <th>Punti</th>
                        </tr>
                    </thead>
                    <tbody id="scoreboard-body">
                        <!-- Scoreboard Rows -->
                    </tbody>
                </table>
            </div>
            
            <div id="endgame-controls" style="display:none; margin-bottom: 20px;">
                <button id="show-table-btn" onclick="switchTab('table')" style="background:#3498db; margin-bottom:10px;" data-i18n="showDetails"></button>
                <button onclick="downloadSummary()" style="background:#2ecc71; margin-bottom:10px;" data-i18n="share"></button>
                <button onclick="resetGame(true)" class="danger" data-i18n="newGame"></button>
            </div>



            <h3 style="margin-left: 5px; color:#666;" data-i18n="history">Storico Round (Modificabile)</h3>
            <div id="history-list">
                <!-- History Cards -->
            </div>
        </div>
        
        <!-- TAB TABLE -->
        <div id="tab-table" style="display:none;">
            <div class="card">
                <h3 data-i18n="roundDetails">Dettagli Round</h3>
                <div class="table-container">
                    <table id="results-table" class="results-table">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </div>
                <button id="back-to-score-btn" onclick="switchTab('score')" class="secondary" style="margin-top:15px; display:none;" data-i18n="backToScore"></button>
            </div>
        </div>
        
        <div style="margin-top: 30px;">
            <button class="secondary" onclick="resetGame(false)" data-i18n="reset">Riavvia / Azzera Dati</button>
        </div>
    </div>

    <!-- STATS SCREEN -->
    <div id="screen-stats" class="container" style="display:none;">
        <div class="card">
            <h2 data-i18n="statsTitle">Statistiche Partite</h2>
            <p style="font-size:0.9rem; color:#666; margin-bottom:20px;" data-i18n="statsSub">Storico delle partite concluse salvato sul dispositivo.</p>
            
            <div id="stats-list">
                <!-- Stats items populated by JS -->
            </div>

            <div style="margin-top: 30px;">
                <button onclick="showHome()" class="secondary" data-i18n="back">Torna Indietro</button>
                <button onclick="clearStats()" class="danger" style="margin-top:10px;" data-i18n="clear">Cancella Storico</button>
            </div>
        </div>
    </div>

</div>

<!-- INFO MODAL -->
<div id="info-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="info-header">
            <img src="assets/logo.png" class="info-logo" alt="Logo">
            <h3 data-i18n="appFullTitle">Podrida Segnapunti</h3>
            <div class="info-version" data-i18n="version">Versione 1.0.0</div>
        </div>
        <p data-i18n="devBy">App sviluppata per gestire facilmente i punteggi delle tue partite.</p>
        
        <div class="info-links">
            <div style="text-align:center;">
                <p data-i18n="like">Ti piace l'app?</p>
                <!-- Ko-fi Link -->
                <a href="https://ko-fi.com/albertone" target="_blank" class="info-btn" style="display:block; background:#f1c40f; font-weight:bold; color:#fff; border:none;" data-i18n="coffee">Offrimi un caff√® ‚òï</a>
            </div>
        </div>

        <button onclick="closeInfoModal()" style="margin-top: 20px;" data-i18n="close">Chiudi</button>
    </div>
</div>

<!-- EDIT ROUND MODAL -->
<div id="edit-modal" class="modal-overlay">
    <div class="modal-content">
        <h3><span data-i18n="edit">Modifica</span> <span data-i18n="round">Round</span> <span id="edit-round-num"></span></h3>
        
        <div class="tabs">
            <div id="edit-tab-bids" class="tab active" onclick="switchEditTab('bids')" data-i18n="bidding">Chiamate</div>
            <div id="edit-tab-takes" class="tab" onclick="switchEditTab('takes')" data-i18n="taking">Prese</div>
        </div>

        <div id="edit-inputs">
            <!-- Dynamic inputs for editing -->
        </div>

        <div id="edit-validation-msg" style="color:red; display:none; margin-bottom:10px; font-weight:bold;"></div>

        <div style="margin-top: 15px; display: flex; gap: 10px;">
            <button onclick="saveEdit()" data-i18n="save">Salva</button> <!-- Need to add Save translation -->
            <button class="secondary" onclick="closeEditModal()" data-i18n="cancel">Annulla</button> <!-- Need to add Cancel translation -->
        </div>
    </div>
</div>

<script src="js/i18n.js"></script>
<script src="js/logic.js"></script>
<script src="js/ui.js"></script>
<script src="js/table-ui.js"></script>
<script src="js/app.js"></script>


</body>
</html>
